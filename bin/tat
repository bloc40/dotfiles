#!/bin/sh

tat() {
  __create_if_needed_and_attach
}

__create_if_needed_and_attach() {
  if __not_in_tmux; then
    __create_and_attach
  else
    if ! __session_exists; then
      __create_detached_session
    fi
    __switch_to_session
  fi
}

__not_in_tmux() {
  [ -z "$TMUX" ]
}

__create_and_attach() {
  tmux new-session -As `__session_name`
}

__session_exists() {
  tmux list-sessions | sed -E 's/:.*$//' | grep -q ^`__session_name`$
}

__create_detached_session() {
  (TMUX='' tmux new-session -Ad -s `__session_name`)
}

__switch_to_session() {
  tmux switch-client -t `__session_name`
}

__session_name() {
  echo `basename $PWD`
}
