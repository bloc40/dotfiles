#!/bin/sh

# create or attach Tmux session named the same as current directory.

_session_name() {
  echo `basename $PWD`
}

_not_in_tmux() {
  [ -z "$TMUX" ]
}

_session_exists() {
  tmux list-sessions | sed -E 's/:.*$//' | grep -q ^`_session_name`$
}

_create_detached_session() {
  (TMUX='' tmux new-session -Ad -s `_session_name`)
}

_create_and_attach() {
  tmux new-session -As `_session_name`
}

_switch_to_session() {
  tmux switch-client -t `_session_name`
}

_create_if_needed_and_attach() {
  if _not_in_tmux; then
    _create_and_attach
  else
    if ! _session_exists; then
      _create_detached_session
    fi
    _switch_to_session
  fi
}

tat() {
  _create_if_needed_and_attach
}
