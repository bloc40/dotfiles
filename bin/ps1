#!/bin/sh

RED=31m
GREEN=32m

git_repo() {
  [[ `git rev-parse --is-inside-work-tree 2>/dev/null` == true ]]
}

git_modified() {
  [[ `git ls-files -m` != '' ]]
}

git_untracked() {
  [[ `git ls-files -o --exclude-standard` != '' ]]
}

git_staged() {
  [[ `git diff --staged --name-only` != '' ]]
}

git_dirty() {
  git_modified || git_untracked || git_staged
}

clear() {
  printf "\e[00m"
}

git_branch_color() {
  if git_repo; then
    if git_dirty; then
      printf "\e[${RED}"
    else
      printf "\e[${GREEN}"
    fi
  fi
}

git_branch() {
  git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1) /'
}

ruby_version() {
  echo `~/.rvm/bin/rvm-prompt`
}

print_pre_prompt() {
  printf "\e[1;30m%$(($COLUMNS))s" $(ruby_version)
}

command_state() {
  echo "\$(if [[ \$? == 0 ]]; then echo \"\[\033[0;32m\]â˜º\"; else echo \"\[\033[0;31m\]â˜¹\"; fi)\[\033[00m\]"
}

show_jobs() {
  if [[ `jobs` != '' ]]; then
    count=`jobs | wc -l | awk '{print($1)}'`
    printf "\e[33m [ðŸ‘»- "$count"]"
  fi
}

PROMPT_COMMAND=print_pre_prompt
export CLICOLOR=1
export PS1="$(command_state)\$(clear) \[\033[44m\]\w\$(clear)\$(show_jobs) \$(git_branch_color)\$(git_branch)\$(clear)"
